<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FUCKINGPACK* | Login</title>
    <link rel="stylesheet" href="painel.css" />
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&family=Sora:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>FUCKINGPACK*</h1>
        <h2>Acesso Restrito</h2>
    </header>
    <main>
        <div class="login-container">
            <div id="login-form" class="form-container">
                <h3>Login</h3>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <form id="auth-form" onsubmit="autenticar(event)">
                    <div class="form-group">
                        <label for="password">Senha:</label>
                        <input type="password" id="password" name="password" required placeholder="Digite a senha de acesso">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Entrar</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <script>
        // URL do Google Apps Script publicado como aplicativo da web
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw3t1Du_aX_EbljanlJgV9Zh3AR_gY006xtEilrmFEqlgLf0pQ8pYADHWxqnd983EPu/exec';
        
        // Verificar se já existe uma sessão ativa
        window.onload = function() {
            const authToken = localStorage.getItem('authToken');
            if (authToken) {
                // Verificar se o token ainda é válido
                verificarAutenticacao(authToken);
            }
        };
        
        // Função para autenticar o usuário
        async function autenticar(event) {
            event.preventDefault();
            
            const senha = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');
            
            try {
                // Verificar a senha
                const response = await fetch(`${SCRIPT_URL}?checkAuth=true&auth=${senha}`);
                const data = await response.json();
                
                if (data.success) {
                    // Armazenar o token de autenticação
                    localStorage.setItem('authToken', senha);
                    
                    // Redirecionar para o painel
                    window.location.href = 'painel.html';
                } else {
                    // Exibir mensagem de erro
                    errorElement.textContent = 'Senha incorreta. Tente novamente.';
                    errorElement.style.display = 'block';
                    
                    // Limpar o campo de senha
                    document.getElementById('password').value = '';
                }
            } catch (error) {
                console.error('Erro:', error);
                errorElement.textContent = 'Erro ao autenticar. Tente novamente mais tarde.';
                errorElement.style.display = 'block';
            }
        }
        
        // Função para verificar se o token de autenticação ainda é válido
        async function verificarAutenticacao(token) {
            try {
                const response = await fetch(`${SCRIPT_URL}?checkAuth=true&auth=${token}`);
                const data = await response.json();
                
                if (data.success) {
                    // Token válido, redirecionar para o painel
                    window.location.href = 'painel.html';
                } else {
                    // Token inválido, remover do localStorage
                    localStorage.removeItem('authToken');
                }
            } catch (error) {
                console.error('Erro:', error);
                // Em caso de erro, remover o token para garantir
                localStorage.removeItem('authToken');
            }
        }
    </script>
</body>
</html>

